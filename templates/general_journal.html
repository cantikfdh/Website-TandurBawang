{% extends "base.html" %}

{% block content %}
<div class="p-6 bg-gradient-to-br from-purple-50 to-indigo-50 min-h-screen">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center gap-3">
            <div class="bg-purple-600 p-2 rounded-lg">
                <i class="fas fa-book text-white text-lg"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-purple-800">General Journal</h1>
                <p class="text-gray-600">Jurnal umum semua transaksi keuangan</p>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-[#c848ac] p-4 rounded-lg border border-[#b33c9a] shadow-sm">
            <div class="flex items-center">
                <div class="p-2 bg-[#b33c9a] rounded-lg w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-book text-white text-lg"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-purple-100">Total Entri</h3>
                    <p class="text-xl font-bold text-white">{{ journal_entries|length }}</p>
                </div>
            </div>
        </div>
        <div class="bg-[#c848ac] p-4 rounded-lg border border-[#b33c9a] shadow-sm">
            <div class="flex items-center">
                <div class="p-2 bg-[#b33c9a] rounded-lg w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-arrow-down text-white text-lg"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-purple-100">Total Debit</h3>
                    <p class="text-xl font-bold text-white">Rp {{ "{:,.2f}".format(total_debit) }}</p>
                </div>
            </div>
        </div>
        <div class="bg-[#c848ac] p-4 rounded-lg border border-[#b33c9a] shadow-sm">
            <div class="flex items-center">
                <div class="p-2 bg-[#b33c9a] rounded-lg w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-arrow-up text-white text-lg"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-purple-100">Total Kredit</h3>
                    <p class="text-xl font-bold text-white">Rp {{ "{:,.2f}".format(total_credit) }}</p>
                </div>
            </div>
        </div>
        <div class="bg-[#c848ac] p-4 rounded-lg border border-[#b33c9a] shadow-sm">
            <div class="flex items-center">
                <div class="p-2 bg-[#b33c9a] rounded-lg w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-balance-scale text-white text-lg"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-purple-100">Status</h3>
                    <p class="text-xl font-bold text-white">
                        {% if total_debit == total_credit %}
                        <span class="text-white">Balance</span>
                        {% else %}
                        <span class="text-white">Unbalance</span>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Only -->
    <div class="mb-6 flex flex-wrap gap-4 items-center">
        <div class="search-box relative">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-500"></i>
            <input type="text" id="searchInput" placeholder="Cari nama akun..." 
                   class="pl-10 pr-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 w-64 bg-white shadow-sm">
        </div>
        
        <button onclick="resetFilters()" class="bg-[#c848ac] hover:bg-[#b33c9a] text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm">
            Reset Filter
        </button>
    </div>

    <!-- Journal Table -->
    <div class="bg-white rounded-lg shadow-sm border border-purple-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full">
                <thead class="bg-[#b564c7]">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider border-r border-[#a459b5]">Date</th>
                        <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider border-r border-[#a459b5]">Account</th>
                        <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider border-r border-[#a459b5]">Ref.</th>
                        <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider border-r border-[#a459b5]">Debit</th>
                        <th class="px-4 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">Credit</th>
                    </tr>
                </thead>
                <tbody class="bg-white" id="journalTable">
                    {% for transaction in transactions %}
                    <!-- Transaction Group -->
                    <tr class="border-b border-purple-100">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600 align-middle border-r border-purple-100 bg-white" rowspan="2">
                            <div class="flex items-center justify-center h-full font-medium">
                                {{ transaction.date.strftime('%d/%m/%Y') }}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800 border-r border-purple-100 bg-white">
                            {{ transaction.debit_entry.account_name }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600 border-r border-purple-100 bg-white">
                            {{ transaction.debit_entry.account_code }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800 border-r border-purple-100 bg-white">
                            <span class="text-black">Rp {{ "{:,.2f}".format(transaction.debit_entry.debit) }}</span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800 bg-white">
                            <!-- Empty for debit entry -->
                        </td>
                    </tr>
                    <tr class="border-b border-purple-200">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800 border-r border-purple-100 bg-white">
                            {{ transaction.credit_entry.account_name }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600 border-r border-purple-100 bg-white">
                            {{ transaction.credit_entry.account_code }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800 border-r border-purple-100 bg-white">
                            <!-- Empty for credit entry -->
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800 bg-white">
                            <span class="text-black">Rp {{ "{:,.2f}".format(transaction.credit_entry.credit) }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="bg-[#b564c7] border-t-2 border-[#a459b5]">
                    <tr>
                        <td colspan="3" class="px-4 py-3 text-sm font-bold text-white text-right border-r border-[#a459b5]">
                            TOTAL:
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-bold text-white border-r border-[#a459b5]">
                            <span class="text-white">Rp {{ "{:,.2f}".format(total_debit) }}</span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-bold text-white">
                            <span class="text-white">Rp {{ "{:,.2f}".format(total_credit) }}</span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Empty State -->
    {% if not transactions %}
    <div class="bg-white rounded-lg border border-purple-200 p-12 text-center shadow-sm">
        <i class="fas fa-book-open text-purple-300 text-6xl mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Belum ada entri jurnal</h3>
        <p class="text-gray-500 mb-4">Transaksi yang Anda buat akan muncul di sini.</p>
        <a href="{{ url_for('transactions') }}" class="bg-[#c848ac] hover:bg-[#b33c9a] text-white px-4 py-2 rounded-lg inline-flex items-center gap-2 transition shadow-sm">
            <i class="fas fa-plus"></i>
            Buat Transaksi Pertama
        </a>
    </div>
    {% endif %}

    <!-- Summary -->
    {% if transactions %}
    <div class="mt-4 text-sm text-gray-600">
        Menampilkan <span class="font-semibold text-purple-700">{{ journal_entries|length }}</span> entri jurnal
        {% if total_debit == total_credit %}
        - <span class="text-green-600 font-semibold">✓ Jurnal Balance</span>
        {% else %}
        - <span class="text-red-600 font-semibold">✗ Jurnal Tidak Balance</span>
        {% endif %}
    </div>
    {% endif %}
</div>

<script>
// Filter Functions
document.getElementById('searchInput').addEventListener('input', function(e) {
    filterJournalEntries();
});

function filterJournalEntries() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('tbody tr');
    
    let visibleCount = 0;
    
    // Show/hide transaction groups (pairs of rows)
    for (let i = 0; i < rows.length; i += 2) {
        const debitRow = rows[i];
        const creditRow = rows[i + 1];
        
        if (debitRow && creditRow) {
            const debitAccount = debitRow.cells[1].textContent.toLowerCase();
            const creditAccount = creditRow.cells[1].textContent.toLowerCase();
            
            const matchesSearch = !searchTerm || 
                                debitAccount.includes(searchTerm) || 
                                creditAccount.includes(searchTerm);
            
            if (matchesSearch) {
                debitRow.style.display = '';
                creditRow.style.display = '';
                visibleCount += 2;
            } else {
                debitRow.style.display = 'none';
                creditRow.style.display = 'none';
            }
        }
    }
    
    // Update visible count
    const summary = document.querySelector('.text-sm.text-gray-600');
    if (summary && visibleCount > 0) {
        summary.innerHTML = `Menampilkan <span class="font-semibold text-purple-700">${visibleCount}</span> entri jurnal
        {% if total_debit == total_credit %}
        - <span class="text-green-600 font-semibold">✓ Jurnal Balance</span>
        {% else %}
        - <span class="text-red-600 font-semibold">✗ Jurnal Tidak Balance</span>
        {% endif %}`;
    }
}

function resetFilters() {
    document.getElementById('searchInput').value = '';
    
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(row => {
        row.style.display = '';
    });
    
    // Reset summary
    const summary = document.querySelector('.text-sm.text-gray-600');
    if (summary) {
        summary.innerHTML = `Menampilkan <span class="font-semibold text-purple-700">{{ journal_entries|length }}</span> entri jurnal
        {% if total_debit == total_credit %}
        - <span class="text-green-600 font-semibold">✓ Jurnal Balance</span>
        {% else %}
        - <span class="text-red-600 font-semibold">✗ Jurnal Tidak Balance</span>
        {% endif %}`;
    }
}
</script>

<style>
/* Custom styles for better appearance */
.bg-gradient-to-br {
    background-image: linear-gradient(135deg, #faf5ff 0%, #e0e7ff 100%);
}

/* Smooth transitions */
.transition {
    transition: all 0.3s ease;
}

/* Shadow improvements */
.shadow-sm {
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

/* Ensure consistent icon alignment */
.flex.items-center > div:first-child {
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
{% endblock %}