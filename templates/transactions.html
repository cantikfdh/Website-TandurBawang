{% extends "base.html" %}

{% block content %}
<div class="p-6">
    <!-- Header Section -->
    <div class="mb-8">
        <div class="flex items-center mb-3">
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                <i class="fas fa-exchange-alt text-white text-lg"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-1" style="font-family: 'Inter', system-ui, sans-serif; font-weight: 700; letter-spacing: -0.025em;">Transactions</h1>
                <p class="text-gray-600 text-base">Kelola transaksi keuangan Anda</p>
            </div>
        </div>
    </div>

    <!-- Add Transaction Form -->
    <div class="bg-[#b564c7] rounded-2xl shadow-lg p-8 mb-8">
        <h2 class="text-2xl font-bold text-white mb-6">Tambah Transaksi Baru</h2>
        <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-semibold text-white mb-2">Tanggal</label>
                <input type="date" name="date" value="{{ today }}" required
                       class="w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white text-gray-900">
            </div>
            <div>
                <label class="block text-sm font-semibold text-white mb-2">Deskripsi</label>
                <input type="text" name="description" required placeholder="Masukkan deskripsi transaksi"
                       class="w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white text-gray-900 placeholder-gray-500">
            </div>
            <div>
                <label class="block text-sm font-semibold text-white mb-2">Akun Debit</label>
                <select name="account_debit" required
                        class="w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white text-gray-900">
                    <option value="" class="text-gray-500">Pilih Akun Debit</option>
                    <optgroup label="Akun Debit Normal" class="text-gray-600">
                        {% for account in accounts if account.normal_balance == 'Debit' %}
                        <option value="{{ account.account_code }}" class="text-gray-700">{{ account.account_name }}</option>
                        {% endfor %}
                    </optgroup>
                    <optgroup label="Akun Lainnya" class="text-gray-600">
                        {% for account in accounts if account.normal_balance == 'Kredit' %}
                        <option value="{{ account.account_code }}" class="text-gray-700">{{ account.account_name }}</option>
                        {% endfor %}
                    </optgroup>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold text-white mb-2">Akun Kredit</label>
                <select name="account_credit" required
                        class="w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white text-gray-900">
                    <option value="" class="text-gray-500">Pilih Akun Kredit</option>
                    <optgroup label="Akun Kredit Normal" class="text-gray-600">
                        {% for account in accounts if account.normal_balance == 'Kredit' %}
                        <option value="{{ account.account_code }}" class="text-gray-700">{{ account.account_name }}</option>
                        {% endfor %}
                    </optgroup>
                    <optgroup label="Akun Lainnya" class="text-gray-600">
                        {% for account in accounts if account.normal_balance == 'Debit' %}
                        <option value="{{ account.account_code }}" class="text-gray-700">{{ account.account_name }}</option>
                        {% endfor %}
                    </optgroup>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold text-white mb-2">Jumlah (Rp)</label>
                <input type="number" name="amount" step="0.01" min="0" required placeholder="0.00"
                       class="w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white text-gray-900 placeholder-gray-500">
            </div>
            <div class="flex items-end">
                <button type="submit" 
                        class="w-full bg-[#E0AAFF] text-purple-900 py-4 px-6 rounded-xl hover:bg-[#d19ef5] focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 transition duration-200 font-bold text-lg shadow-lg">
                    <i class="fas fa-plus-circle mr-2"></i>
                    Tambah Transaksi
                </button>
            </div>
        </form>
    </div>

    <!-- Transactions List -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-[#b564c7]">Daftar Transaksi</h2>
            <div class="text-sm text-gray-500">
                Total: <span class="font-semibold text-[#b564c7]">{{ transactions|length }} transaksi</span>
            </div>
        </div>
        
        <!-- Summary Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-gradient-to-r from-[#c848ac] to-[#b564c7] p-6 rounded-2xl border-0 shadow-lg">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-list text-white text-lg"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-white opacity-90">Total Transaksi</div>
                        <div class="text-3xl font-bold text-white">{{ transactions|length }}</div>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-[#c848ac] to-[#b564c7] p-6 rounded-2xl border-0 shadow-lg">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-arrow-down text-white text-lg"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-white opacity-90">Total Debit</div>
                        <div class="text-2xl font-bold text-white">Rp {{ "{:,.2f}".format(total_amount) }}</div>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-[#c848ac] to-[#b564c7] p-6 rounded-2xl border-0 shadow-lg">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-arrow-up text-white text-lg"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-white opacity-90">Total Kredit</div>
                        <div class="text-2xl font-bold text-white">Rp {{ "{:,.2f}".format(total_amount) }}</div>
                    </div>
                </div>
            </div>
        </div>

        {% if transactions %}
        <div class="overflow-x-auto rounded-2xl border border-gray-200">
            <table class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr class="bg-[#b564c7]">
                        <th class="px-8 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-white border-opacity-30">Tanggal</th>
                        <th class="px-8 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-white border-opacity-30">Deskripsi</th>
                        <th class="px-8 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-white border-opacity-30">Akun Debit</th>
                        <th class="px-8 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-white border-opacity-30">Akun Kredit</th>
                        <th class="px-8 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-white border-opacity-30">Jumlah</th>
                        <th class="px-8 py-4 text-left text-sm font-semibold text-white uppercase tracking-wider">Aksi</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for transaction in transactions|sort(attribute='date') %}
                    <tr class="hover:bg-purple-50 transition duration-150">
                        <td class="px-8 py-4 whitespace-nowrap text-sm font-medium text-gray-900 border-r border-gray-200">
                            {{ transaction.date.strftime('%d/%m/%Y') }}
                        </td>
                        <td class="px-8 py-4 text-sm text-gray-900 border-r border-gray-200">
                            <div class="font-medium">{{ transaction.description }}</div>
                        </td>
                        <td class="px-8 py-4 text-sm text-gray-900 border-r border-gray-200">
                            {% set debit_account = accounts|selectattr("account_code", "equalto", transaction.account_debit)|first %}
                            {% if debit_account %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-arrow-down mr-1 text-xs"></i>
                                {{ debit_account.account_name }}
                            </span>
                            {% else %}
                            <span class="text-red-500">Akun tidak ditemukan</span>
                            {% endif %}
                        </td>
                        <td class="px-8 py-4 text-sm text-gray-900 border-r border-gray-200">
                            {% set credit_account = accounts|selectattr("account_code", "equalto", transaction.account_credit)|first %}
                            {% if credit_account %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-arrow-up mr-1 text-xs"></i>
                                {{ credit_account.account_name }}
                            </span>
                            {% else %}
                            <span class="text-red-500">Akun tidak ditemukan</span>
                            {% endif %}
                        </td>
                        <td class="px-8 py-4 whitespace-nowrap text-sm font-bold text-gray-900 border-r border-gray-200">
                            Rp {{ "{:,.2f}".format(transaction.amount) }}
                        </td>
                        <td class="px-8 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex items-center space-x-3">
                                <form method="POST" action="{{ url_for('delete_transaction', id=transaction.id) }}" 
                                      onsubmit="return confirm('Hapus transaksi ini?')" class="inline">
                                    <button type="submit" class="text-red-500 hover:text-red-700 transition duration-150 p-2 rounded-lg hover:bg-red-50" title="Hapus Transaksi">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                                <a href="{{ url_for('general_journal') }}" class="text-blue-500 hover:text-blue-700 p-2 rounded-lg hover:bg-blue-50 transition duration-150" title="Lihat Jurnal">
                                    <i class="fas fa-book"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="bg-gray-50">
                    <tr>
                        <td colspan="4" class="px-8 py-4 text-sm font-bold text-gray-900 text-right border-r border-gray-200">
                            TOTAL:
                        </td>
                        <td class="px-8 py-4 whitespace-nowrap text-sm font-bold text-[#b564c7] border-r border-gray-200">
                            Rp {{ "{:,.2f}".format(total_amount) }}
                        </td>
                        <td class="px-8 py-4"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        {% else %}
        <div class="text-center py-16">
            <div class="w-24 h-24 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-exchange-alt text-purple-400 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-3">Belum ada transaksi</h3>
            <p class="text-gray-500 text-lg mb-8 max-w-md mx-auto">Mulai dengan membuat transaksi pertama Anda untuk mengelola keuangan bisnis.</p>
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-2xl p-6 max-w-md mx-auto">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <i class="fas fa-lightbulb text-purple-400 text-xl mt-1"></i>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-purple-800 mb-2">Tips Transaksi Pertama</h3>
                        <div class="text-purple-700">
                            <p class="mb-2">Contoh: Debit "Kas", Kredit "Modal" untuk menyetorkan modal awal.</p>
                            <p>Pastikan jumlah debit dan kredit selalu seimbang.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Auto-format amount input
document.querySelector('input[name="amount"]').addEventListener('input', function(e) {
    // Remove non-numeric characters except decimal point
    let value = e.target.value.replace(/[^\d.]/g, '');
    
    // Ensure only one decimal point
    const decimalCount = value.split('.').length - 1;
    if (decimalCount > 1) {
        value = value.substring(0, value.lastIndexOf('.'));
    }
    
    e.target.value = value;
});

// Prevent form submission if debit and credit accounts are the same
document.querySelector('form').addEventListener('submit', function(e) {
    const debitAccount = document.querySelector('select[name="account_debit"]').value;
    const creditAccount = document.querySelector('select[name="account_credit"]').value;
    
    if (debitAccount === creditAccount) {
        e.preventDefault();
        alert('Error: Akun debit dan kredit tidak boleh sama!');
        return false;
    }
    
    const amount = document.querySelector('input[name="amount"]').value;
    if (parseFloat(amount) <= 0) {
        e.preventDefault();
        alert('Error: Jumlah harus lebih dari 0!');
        return false;
    }
});

// Add some interactivity to the table
document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(row => {
        row.addEventListener('click', function(e) {
            if (!e.target.closest('td:last-child')) {
                this.classList.toggle('bg-purple-50');
            }
        });
    });
});
</script>

<style>
/* Custom styles for better UX */
.hover\:bg-purple-50:hover {
    background-color: #faf5ff;
}

/* Smooth transitions */
.transition {
    transition-property: all;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

.duration-150 {
    transition-duration: 150ms;
}

.duration-200 {
    transition-duration: 200ms;
}

/* Custom border styling for table */
table {
    border-collapse: collapse;
}

th, td {
    border-right: 1px solid #e5e7eb;
}

th:last-child, td:last-child {
    border-right: none;
}

/* Header border styling */
th {
    border-right: 1px solid rgba(255, 255, 255, 0.3);
}

th:last-child {
    border-right: none;
}

/* Custom scrollbar for table */
.overflow-x-auto::-webkit-scrollbar {
    height: 8px;
}

.overflow-x-auto::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.overflow-x-auto::-webkit-scrollbar-thumb {
    background: #c848ac;
    border-radius: 4px;
}

.overflow-x-auto::-webkit-scrollbar-thumb:hover {
    background: #b564c7;
}

/* Font styling for header */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
</style>
{% endblock %}