{% extends "base.html" %}

{% block public_content %}
<div class="bg-white/30 backdrop-blur-md shadow-xl rounded-2xl p-8 w-full max-w-md">
    <h1 class="text-3xl font-bold text-center text-purple-900 mb-6">
        Daftar Akun
    </h1>

    {% if errors %}
    <div class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
        <ul class="list-disc list-inside">
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form method="POST" class="space-y-4" onsubmit="return validateForm()">
        <div>
            <label class="font-semibold text-gray-700">Username</label>
            <input 
                type="text" 
                name="username"
                id="username"
                required
                class="w-full mt-1 p-2 rounded-lg border border-purple-300 focus:ring-2 focus:ring-purple-600"
            >
            <p class="text-sm text-gray-600 mt-1">Username harus minimal 6 huruf </p>
            <div id="username-error" class="text-red-500 text-sm mt-1 hidden"></div>
        </div>

        <div>
            <label class="font-semibold text-gray-700">Email</label>
            <input 
                type="email" 
                name="email"
                id="email"
                required
                class="w-full mt-1 p-2 rounded-lg border border-purple-300 focus:ring-2 focus:ring-purple-600"
            >
            <div id="email-error" class="text-red-500 text-sm mt-1 hidden"></div>
        </div>

        <div>
            <label class="font-semibold text-gray-700">Password</label>
            <input 
                type="password" 
                name="password"
                id="password"
                required
                class="w-full mt-1 p-2 rounded-lg border border-purple-300 focus:ring-2 focus:ring-purple-600"
            >
            <p class="text-sm text-gray-600 mt-1">Password harus minimal 6 karakter dengan kombinasi huruf dan angka</p>
            <div id="password-error" class="text-red-500 text-sm mt-1 hidden"></div>
        </div>

        <button 
            type="submit"
            id="submit-btn"
            class="w-full bg-purple-700 hover:bg-purple-800 text-white py-2 rounded-lg font-semibold transition">
            Register
        </button>
    </form>

    <p class="text-center mt-4 text-gray-700">
        Sudah punya akun?
        <a href="/login" class="text-purple-900 font-semibold hover:underline">Login di sini</a>
    </p>
</div>

<script>
function validateForm() {
    let isValid = true;
    
    // Reset error messages
    document.getElementById('username-error').classList.add('hidden');
    document.getElementById('password-error').classList.add('hidden');
    document.getElementById('email-error').classList.add('hidden');
    
    // Get values
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const email = document.getElementById('email').value.trim();
    
    // Validate username (minimal 6 huruf, hanya huruf)
    const usernameRegex = /^[A-Za-z]{6,}$/;
    if (!usernameRegex.test(username)) {
        document.getElementById('username-error').textContent = 'Username harus minimal 6 karakter dan hanya terdiri dari huruf';
        document.getElementById('username-error').classList.remove('hidden');
        isValid = false;
    }
    
    // Validate email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        document.getElementById('email-error').textContent = 'Format email tidak valid';
        document.getElementById('email-error').classList.remove('hidden');
        isValid = false;
    }
    
    // Validate password (minimal 6 karakter, kombinasi huruf dan angka)
    const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;
    if (!passwordRegex.test(password)) {
        document.getElementById('password-error').textContent = 'Password harus minimal 6 karakter dengan kombinasi huruf dan angka';
        document.getElementById('password-error').classList.remove('hidden');
        isValid = false;
    }
    
    return isValid;
}

// Real-time validation
document.getElementById('username').addEventListener('input', function() {
    const username = this.value.trim();
    const usernameRegex = /^[A-Za-z]{6,}$/;
    
    if (username.length > 0 && !usernameRegex.test(username)) {
        document.getElementById('username-error').textContent = 'Username harus minimal 6 karakter dan hanya terdiri dari huruf';
        document.getElementById('username-error').classList.remove('hidden');
    } else {
        document.getElementById('username-error').classList.add('hidden');
    }
});

document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;
    
    if (password.length > 0 && !passwordRegex.test(password)) {
        document.getElementById('password-error').textContent = 'Password harus minimal 6 karakter dengan kombinasi huruf dan angka';
        document.getElementById('password-error').classList.remove('hidden');
    } else {
        document.getElementById('password-error').classList.add('hidden');
    }
});

document.getElementById('email').addEventListener('input', function() {
    const email = this.value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (email.length > 0 && !emailRegex.test(email)) {
        document.getElementById('email-error').textContent = 'Format email tidak valid';
        document.getElementById('email-error').classList.remove('hidden');
    } else {
        document.getElementById('email-error').classList.add('hidden');
    }
});
</script>

<style>
.hidden {
    display: none;
}
</style>
{% endblock %}