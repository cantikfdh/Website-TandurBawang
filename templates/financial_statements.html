{% extends "base.html" %}
{% block title %}Laporan Keuangan - Tandur Bawang{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-[#b564c7] rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="text-center">
                <h1 class="text-2xl font-bold text-white mb-1">TANDUR BAWANG</h1>
                <h2 class="text-xl font-semibold text-white mb-1">LAPORAN KEUANGAN</h2>
                <p class="text-lg text-white">Periode: {{ period }}</p>
                <p class="text-sm text-white opacity-90">Dicetak pada: {{ current_date.strftime('%d/%m/%Y %H:%M') }}</p>
            </div>
        </div>

        <!-- Financial Statements Tabs -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
            <div class="border-b border-gray-200">
                <nav class="flex -mb-px">
                    <button onclick="showTab('incomeStatement')" 
                            class="py-4 px-6 text-center border-b-2 border-purple-500 font-medium text-sm text-purple-600 bg-purple-50 flex-1">
                        <i class="fas fa-chart-line mr-2"></i>
                        LABA RUGI
                    </button>
                    <button onclick="showTab('balanceSheet')" 
                            class="py-4 px-6 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 flex-1">
                        <i class="fas fa-balance-scale mr-2"></i>
                        NERACA
                    </button>
                    <button onclick="showTab('equityStatement')" 
                            class="py-4 px-6 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 flex-1">
                        <i class="fas fa-users mr-2"></i>
                        PERUBAHAN MODAL
                    </button>
                </nav>
            </div>

            <!-- Income Statement -->
            <div id="incomeStatement" class="tab-content p-6">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden mb-6">
                    <div class="bg-[#b564c7] text-white px-6 py-4">
                        <h2 class="text-lg font-semibold">LAPORAN LABA RUGI</h2>
                    </div>
                    <div class="p-6">
                        <!-- Pendapatan -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-gray-200 pb-2">PENDAPATAN</h3>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Penjualan Bawang Merah</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.revenue) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4">
                                    <span class="font-semibold text-gray-800">Total Pendapatan</span>
                                    <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(income_statement.revenue) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Harga Pokok Penjualan -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-gray-200 pb-2">HARGA POKOK PENJUALAN</h3>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Harga Pokok Penjualan</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.hpp) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4">
                                    <span class="font-semibold text-gray-800">Total HPP</span>
                                    <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(income_statement.hpp) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Laba Kotor -->
                        <div class="mb-6 bg-green-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-semibold text-green-800">Laba Kotor</span>
                                <span class="text-xl font-bold text-green-800">Rp {{ "{:,.2f}".format(income_statement.gross_profit) }}</span>
                            </div>
                        </div>

                        <!-- Beban Operasional -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-gray-200 pb-2">BEBAN OPERASIONAL</h3>
                            <div class="space-y-2">
                                <!-- Rincian Beban -->
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Beban Transportasi dan Pengiriman</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.beban_transportasi) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Beban Tenaga Kerja dan Gaji</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.beban_tenaga_kerja) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Beban Sewa Tempat/Tanah</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.beban_sewa) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Beban Perbaikan dan Pemeliharaan</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.beban_perbaikan) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Beban Penyusutan</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.beban_penyusutan) }}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">Beban Lain-lain</span>
                                    <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.beban_lain_lain) }}</span>
                                </div>
                                
                                <!-- Total Beban Operasional -->
                                <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4 mt-4">
                                    <span class="font-semibold text-gray-800">Total Beban Operasional</span>
                                    <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(income_statement.operating_expenses_detailed.total) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Laba Bersih -->
                        <div class="bg-[#c848ac] rounded-lg p-6 text-white">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-semibold">LABA BERSIH</span>
                                <span class="text-2xl font-semibold">
                                    Rp {{ "{:,.2f}".format(income_statement.net_income) }}
                                </span>
                            </div>
                            <div class="text-sm opacity-90 mt-2">
                                {% if income_statement.net_income > 0 %}
                                ✅ Perusahaan mengalami laba
                                {% else %}
                                ⚠️ Perusahaan mengalami rugi
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Balance Sheet -->
            <div id="balanceSheet" class="tab-content p-6 hidden">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <div class="bg-[#b564c7] text-white px-6 py-4">
                        <h2 class="text-lg font-semibold">NERACA</h2>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Aset -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-gray-200 pb-2">ASET</h3>
                                <div class="space-y-3">
                                    <!-- Aset Lancar -->
                                    <div class="mb-4">
                                        <h4 class="font-semibold text-gray-700 mb-2">Aset Lancar</h4>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Kas & Bank</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.assets_detailed.kas_bank) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Persediaan Bawang Merah</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.assets_detailed.persediaan) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4 mt-2">
                                            <span class="font-semibold text-gray-800">Total Aset Lancar</span>
                                            <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.assets_detailed.kas_bank + balance_sheet.assets_detailed.persediaan) }}</span>
                                        </div>
                                    </div>

                                    <!-- Aset Tetap -->
                                    <div class="mb-4">
                                        <h4 class="font-semibold text-gray-700 mb-2">Aset Tetap</h4>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Peralatan Usaha</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.assets_detailed.peralatan) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Akumulasi Penyusutan</span>
                                            <span class="text-red-600">(Rp {{ "{:,.2f}".format(balance_sheet.assets_detailed.akumulasi_penyusutan) }})</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4 mt-2">
                                            <span class="font-semibold text-gray-800">Total Aset Tetap</span>
                                            <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.assets_detailed.peralatan - balance_sheet.assets_detailed.akumulasi_penyusutan) }}</span>
                                        </div>
                                    </div>

                                    <!-- Total Aset -->
                                    <div class="flex justify-between items-center py-3 bg-gray-100 rounded px-4 mt-4 border-t border-gray-200">
                                        <span class="font-semibold text-gray-800 text-lg">TOTAL ASET</span>
                                        <span class="font-semibold text-gray-900 text-lg">
                                            Rp {{ "{:,.2f}".format(
                                                (balance_sheet.assets_detailed.kas_bank + balance_sheet.assets_detailed.persediaan) +
                                                (balance_sheet.assets_detailed.peralatan - balance_sheet.assets_detailed.akumulasi_penyusutan)
                                            ) }}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Kewajiban & Ekuitas -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-gray-200 pb-2">KEWAJIBAN & EKUITAS</h3>
                                <div class="space-y-3">
                                    <!-- Kewajiban -->
                                    <div class="mb-4">
                                        <h4 class="font-semibold text-gray-700 mb-2">Kewajiban</h4>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Utang Usaha</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.liabilities_detailed.utang_usaha) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Utang Lainnya</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.liabilities_detailed.utang_lainnya) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4 mt-2">
                                            <span class="font-semibold text-gray-800">Total Kewajiban</span>
                                            <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.liabilities) }}</span>
                                        </div>
                                    </div>

                                    <!-- Ekuitas -->
                                    <div class="mb-4">
                                        <h4 class="font-semibold text-gray-700 mb-2">Ekuitas</h4>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Modal Awal</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.initial_equity) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Laba Bersih</span>
                                            <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.net_income) }}</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span class="text-gray-600 text-sm">Prive</span>
                                            <span class="text-red-600">(Rp {{ "{:,.2f}".format(balance_sheet.prive) }})</span>
                                        </div>
                                        <div class="flex justify-between items-center py-2 bg-gray-50 rounded px-4 mt-2">
                                            <span class="font-semibold text-gray-800">Modal Akhir</span>
                                            <span class="font-semibold text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.equity) }}</span>
                                        </div>
                                    </div>

                                    <!-- Total Kewajiban & Ekuitas -->
                                    <div class="flex justify-between items-center py-3 bg-gray-100 rounded px-4 mt-4 border-t border-gray-200">
                                        <span class="font-semibold text-gray-800 text-lg">TOTAL KEWAJIBAN & EKUITAS</span>
                                        <span class="font-semibold text-gray-900 text-lg">Rp {{ "{:,.2f}".format(balance_sheet.liabilities + balance_sheet.equity) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Balance Check -->
                        <div class="mt-6 p-4 rounded-lg {% if (balance_sheet.assets_detailed.kas_bank + balance_sheet.assets_detailed.persediaan + (balance_sheet.assets_detailed.peralatan - balance_sheet.assets_detailed.akumulasi_penyusutan)) == (balance_sheet.liabilities + balance_sheet.equity) %}bg-green-500{% else %}bg-red-500{% endif %} text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas {% if (balance_sheet.assets_detailed.kas_bank + balance_sheet.assets_detailed.persediaan + (balance_sheet.assets_detailed.peralatan - balance_sheet.assets_detailed.akumulasi_penyusutan)) == (balance_sheet.liabilities + balance_sheet.equity) %}fa-check-circle{% else %}fa-exclamation-triangle{% endif %} text-xl mr-3"></i>
                                    <span class="font-semibold">
                                        {% if (balance_sheet.assets_detailed.kas_bank + balance_sheet.assets_detailed.persediaan + (balance_sheet.assets_detailed.peralatan - balance_sheet.assets_detailed.akumulasi_penyusutan)) == (balance_sheet.liabilities + balance_sheet.equity) %}
                                        ✅ Neraca Seimbang
                                        {% else %}
                                        ⚠️ Neraca Tidak Seimbang
                                        {% endif %}
                                    </span>
                                </div>
                                <span class="text-sm">
                                    Selisih: Rp {{ "{:,.2f}".format(
                                        ((balance_sheet.assets_detailed.kas_bank + balance_sheet.assets_detailed.persediaan + 
                                        (balance_sheet.assets_detailed.peralatan - balance_sheet.assets_detailed.akumulasi_penyusutan)) - 
                                        (balance_sheet.liabilities + balance_sheet.equity))|abs
                                    ) }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equity Statement -->
            <div id="equityStatement" class="tab-content p-6 hidden">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <div class="bg-[#b564c7] text-white px-6 py-4">
                        <h2 class="text-lg font-semibold">LAPORAN PERUBAHAN MODAL</h2>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <span class="text-gray-700">Modal Awal</span>
                                <span class="text-gray-900">Rp {{ "{:,.2f}".format(balance_sheet.initial_equity) }}</span>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <span class="text-gray-700">Laba Bersih</span>
                                <span class="text-gray-900">Rp {{ "{:,.2f}".format(income_statement.net_income) }}</span>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <span class="text-gray-700">Prive</span>
                                <span class="text-red-600">(Rp {{ "{:,.2f}".format(balance_sheet.prive) }})</span>
                            </div>
                            <div class="flex justify-between items-center py-3 bg-[#c848ac] rounded-lg px-4 text-white">
                                <span class="font-semibold">Modal Akhir</span>
                                <span class="font-semibold text-lg">Rp {{ "{:,.2f}".format(balance_sheet.equity) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Button -->
        <div class="flex justify-center mt-6 no-print">
            <button onclick="window.print()" class="bg-[#b564c7] hover:bg-[#9a4da8] text-white font-semibold py-3 px-8 rounded-lg transition duration-200 flex items-center">
                <i class="fas fa-print mr-2"></i>
                Cetak Laporan
            </button>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Show selected tab content
    document.getElementById(tabName).classList.remove('hidden');
    
    // Update active tab button
    document.querySelectorAll('nav button').forEach(button => {
        button.classList.remove('border-purple-500', 'text-purple-600', 'bg-purple-50');
        button.classList.add('border-transparent', 'text-gray-500');
    });
    
    event.target.classList.add('border-purple-500', 'text-purple-600', 'bg-purple-50');
    event.target.classList.remove('border-transparent', 'text-gray-500');
}

// Show income statement by default
document.addEventListener('DOMContentLoaded', function() {
    showTab('incomeStatement');
});
</script>

<style>
@media print {
    .no-print {
        display: none !important;
    }
    body {
        background: white !important;
        font-size: 12px !important;
    }
    .bg-gray-50 {
        background: white !important;
    }
    .shadow-sm {
        box-shadow: none !important;
    }
    .border {
        border-color: #000 !important;
    }
    .hidden {
        display: block !important;
    }
    .tab-content {
        display: block !important;
    }
    nav {
        display: none !important;
    }
    .min-h-screen {
        min-height: auto !important;
    }
    .p-6 {
        padding: 1rem !important;
    }
    .mb-6 {
        margin-bottom: 1rem !important;
    }
    .text-red-600 {
        color: #dc2626 !important;
    }
}
</style>
{% endblock %}